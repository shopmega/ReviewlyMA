{
  "meta": {
    "project": "AVis (Business Discovery & Reviews)",
    "date": "2026-02-21",
    "prepared_by": "Generated by TestSprite"
  },
  "product_overview": "AVis is a French business discovery and review platform that lets visitors browse businesses and categories, while authenticated users can submit/edit reviews and businesses access a Pro dashboard; admins manage platform data. This PRD captures core journeys and API-based user flows for testing and development.",
  "core_goals": [
    "Enable visitors to discover and view business listings and category pages with performant search APIs.",
    "Provide secure authentication flows (signup, login, password recovery) for users.",
    "Allow authenticated users to create and edit reviews and ratings for businesses.",
    "Offer Pro dashboard capabilities (analytics, review management, premium plan management) for business accounts.",
    "Supply an admin console for internal moderation, user and business management, and bulk actions."
  ],
  "features": [
    {
      "name": "Authentication",
      "description": "Email/password sign up, login, and password recovery flows handled by server-side actions.",
      "user_flows": [
        "POST SERVER_ACTION src/app/actions/auth.ts/signup with {email,password} -> Receive 201 Created with user id",
        "POST SERVER_ACTION src/app/actions/auth.ts/login with {email,password} -> Receive 200 with JWT token",
        "POST SERVER_ACTION src/app/actions/auth.ts/session with Authorization: Bearer <token> -> Receive 200 with user profile (session)",
        "POST SERVER_ACTION src/app/actions/auth.ts/login with {email,wrong_password} -> Receive 401 Unauthorized with error 'invalid_credentials'",
        "POST SERVER_ACTION src/app/actions/auth.ts/forgot with {email} -> Receive 200 with {email_sent:true}",
        "POST SERVER_ACTION src/app/actions/auth.ts/reset with {resetToken,new_password} -> Receive 200 password reset complete",
        "POST SERVER_ACTION src/app/actions/auth.ts/reset with {resetToken:invalid,new_password} -> Receive 400 Invalid or expired token"
      ]
    },
    {
      "name": "Business Discovery",
      "description": "Browse and search businesses, filter by category/city, and view business detail data via public search APIs.",
      "user_flows": [
        "GET /api/businesses/search?q=boulangerie&city=paris -> Receive 200 with list of matching businesses",
        "GET /api/v1/businesses/search?slug=boulangerie-du-centre -> Receive 200 with business detail payload",
        "GET /api/businesses/search?category=patisserie&page=2 -> Receive 200 with paginated results",
        "GET /api/businesses/search?q=%20%20%20 (malformed query) -> Receive 400 Bad Request",
        "GET /api/v1/businesses/search?slug=nonexistent-biz -> Receive 404 Not Found"
      ]
    },
    {
      "name": "Reviews and Ratings",
      "description": "Authenticated users can create new reviews and edit existing reviews for businesses using server actions.",
      "user_flows": [
        "POST SERVER_ACTION src/app/actions/review.ts with {businessId, rating:5, text:'Great service'} and Authorization: Bearer <token> -> Receive 201 Review created with reviewId",
        "POST SERVER_ACTION src/app/actions/review.ts/edit with {reviewId, rating:4, text:'Updated feedback'} and Authorization: Bearer <token> -> Receive 200 Review updated",
        "POST SERVER_ACTION src/app/actions/review.ts with {businessId, rating:0, text:'bad'} and Authorization: Bearer <token> -> Receive 400 Validation error (rating out of range)",
        "POST SERVER_ACTION src/app/actions/review.ts with {businessId, rating:5, text:'Nice'} and no Authorization header -> Receive 401 Unauthorized"
      ]
    },
    {
      "name": "Pro Dashboard",
      "description": "Authenticated Pro users access analytics, manage incoming reviews, and upgrade/manage premium features through server actions.",
      "user_flows": [
        "POST SERVER_ACTION src/app/actions/analytics.ts with Authorization: Bearer <pro_token> and body {range:'30d'} -> Receive 200 with analytics payload",
        "POST SERVER_ACTION src/app/actions/premium.ts/upgrade with Authorization: Bearer <pro_token> and body {planId:'premium_monthly'} -> Receive 200 subscription updated (upgrade accepted or pending)",
        "POST SERVER_ACTION src/app/actions/analytics.ts with Authorization: Bearer <non_pro_token> -> Receive 403 Forbidden",
        "POST SERVER_ACTION src/app/actions/premium.ts/upgrade with Authorization: Bearer <pro_token> and missing payment sandbox credentials -> Receive 402 Payment Required (payment provider not configured)"
      ]
    },
    {
      "name": "Admin Console",
      "description": "Internal admins search and manage users and businesses, perform moderation and bulk actions via admin APIs and server actions.",
      "user_flows": [
        "GET /api/admin/users/search?q=dupont with Authorization: Bearer <admin_token> -> Receive 200 with matching user list",
        "GET /api/admin/businesses/search?q=restaurant with Authorization: Bearer <admin_token> -> Receive 200 with matching business list",
        "POST SERVER_ACTION src/app/actions/admin.ts/moderate with {businessId, action:'suspend'} and Authorization: Bearer <admin_token> -> Receive 200 Action confirmed",
        "GET /api/admin/users/search?q=dupont with no Authorization header -> Receive 403 Forbidden",
        "POST SERVER_ACTION src/app/actions/admin.ts/moderate with invalid payload and Authorization: Bearer <admin_token> -> Receive 400 Validation error"
      ]
    }
  ],
  "code_summary": {
    "version": "2",
    "type": "frontend",
    "tech_stack": [
      "TypeScript",
      "Next.js 15 (App Router)",
      "React 19",
      "Tailwind CSS",
      "Supabase"
    ],
    "routes": [
      {
        "path": "/",
        "file": "src/app/page.tsx",
        "auth_required": false,
        "description": "Landing and discovery home page"
      },
      {
        "path": "/login",
        "file": "src/app/login/page.tsx",
        "auth_required": false,
        "description": "User authentication page"
      },
      {
        "path": "/signup",
        "file": "src/app/signup/page.tsx",
        "auth_required": false,
        "description": "Account creation page"
      },
      {
        "path": "/businesses",
        "file": "src/app/businesses/page.tsx",
        "auth_required": false,
        "description": "Business listing directory"
      },
      {
        "path": "/businesses/[slug]",
        "file": "src/app/businesses/[slug]/page.tsx",
        "auth_required": false,
        "description": "Business detail page"
      },
      {
        "path": "/categories",
        "file": "src/app/categories/page.tsx",
        "auth_required": false,
        "description": "Category index"
      },
      {
        "path": "/categorie/[categorySlug]",
        "file": "src/app/categorie/[categorySlug]/page.tsx",
        "auth_required": false,
        "description": "Category-specific listing page"
      },
      {
        "path": "/dashboard",
        "file": "src/app/dashboard/page.tsx",
        "auth_required": true,
        "description": "Pro user dashboard root"
      },
      {
        "path": "/dashboard/reviews",
        "file": "src/app/dashboard/reviews/page.tsx",
        "auth_required": true,
        "description": "Dashboard review management"
      },
      {
        "path": "/dashboard/messages",
        "file": "src/app/dashboard/messages/page.tsx",
        "auth_required": true,
        "description": "Dashboard messaging inbox"
      },
      {
        "path": "/dashboard/premium",
        "file": "src/app/dashboard/premium/page.tsx",
        "auth_required": true,
        "description": "Premium plan management"
      },
      {
        "path": "/profile",
        "file": "src/app/profile/page.tsx",
        "auth_required": true,
        "description": "User profile overview"
      },
      {
        "path": "/support",
        "file": "src/app/support/page.tsx",
        "auth_required": false,
        "description": "Support contact and help page"
      },
      {
        "path": "/admin",
        "file": "src/app/(admin)/admin/page.tsx",
        "auth_required": true,
        "description": "Admin dashboard landing"
      },
      {
        "path": "/admin/utilisateurs",
        "file": "src/app/(admin)/admin/utilisateurs/page.tsx",
        "auth_required": true,
        "description": "Admin user management"
      },
      {
        "path": "/admin/etablissements",
        "file": "src/app/(admin)/admin/etablissements/page.tsx",
        "auth_required": true,
        "description": "Admin businesses management"
      },
      {
        "path": "/salaires",
        "file": "src/app/salaires/page.tsx",
        "auth_required": false,
        "description": "Salary transparency index"
      },
      {
        "path": "/review",
        "file": "src/app/review/page.tsx",
        "auth_required": true,
        "description": "Review submission flow"
      }
    ],
    "features": [
      {
        "name": "Authentication",
        "description": "Email/password sign up, login, and password recovery flows",
        "files": [
          "src/app/login/page.tsx",
          "src/app/signup/page.tsx",
          "src/app/forgot-password/page.tsx",
          "src/app/reset-password/page.tsx",
          "src/app/actions/auth.ts"
        ],
        "entry_route": "/login",
        "user_interactions": [
          "Fill email/password fields",
          "Submit login or signup form",
          "Trigger password recovery and reset flow"
        ],
        "api_calls": [
          {
            "method": "SERVER_ACTION",
            "endpoint": "src/app/actions/auth.ts"
          }
        ],
        "auth_required": false
      },
      {
        "name": "Business Discovery",
        "description": "Browse, search, and open business detail pages",
        "files": [
          "src/app/page.tsx",
          "src/app/businesses/page.tsx",
          "src/app/businesses/[slug]/page.tsx",
          "src/app/actions/search.ts",
          "src/app/api/businesses/search/route.ts"
        ],
        "entry_route": "/",
        "user_interactions": [
          "Use search input and filters",
          "Open a business detail card",
          "Navigate between category and city pages"
        ],
        "api_calls": [
          {
            "method": "GET",
            "endpoint": "/api/businesses/search"
          },
          {
            "method": "GET",
            "endpoint": "/api/v1/businesses/search"
          }
        ],
        "auth_required": false
      },
      {
        "name": "Reviews and Ratings",
        "description": "Users can create and edit reviews for businesses",
        "files": [
          "src/app/review/page.tsx",
          "src/app/businesses/[slug]/review/page.tsx",
          "src/app/reviews/[id]/edit/page.tsx",
          "src/app/actions/review.ts"
        ],
        "entry_route": "/review",
        "user_interactions": [
          "Select target business",
          "Enter rating and textual feedback",
          "Submit or edit existing review"
        ],
        "api_calls": [
          {
            "method": "SERVER_ACTION",
            "endpoint": "src/app/actions/review.ts"
          }
        ],
        "auth_required": true
      },
      {
        "name": "Pro Dashboard",
        "description": "Authenticated businesses manage analytics, reviews, and premium features",
        "files": [
          "src/app/dashboard/page.tsx",
          "src/app/dashboard/analytics/page.tsx",
          "src/app/dashboard/reviews/page.tsx",
          "src/app/dashboard/premium/page.tsx",
          "src/app/actions/analytics.ts",
          "src/app/actions/premium.ts"
        ],
        "entry_route": "/dashboard",
        "user_interactions": [
          "Open dashboard modules from side navigation",
          "View analytics and incoming reviews",
          "Upgrade or manage premium features"
        ],
        "api_calls": [
          {
            "method": "SERVER_ACTION",
            "endpoint": "src/app/actions/analytics.ts"
          },
          {
            "method": "SERVER_ACTION",
            "endpoint": "src/app/actions/premium.ts"
          }
        ],
        "auth_required": true
      },
      {
        "name": "Admin Console",
        "description": "Internal admin manages users, businesses, moderation, categories, and settings",
        "files": [
          "src/app/(admin)/admin/page.tsx",
          "src/app/(admin)/admin/utilisateurs/page.tsx",
          "src/app/(admin)/admin/etablissements/page.tsx",
          "src/app/actions/admin.ts",
          "src/app/actions/admin-bulk.ts"
        ],
        "entry_route": "/admin",
        "user_interactions": [
          "Browse admin sections",
          "Search and update users/businesses",
          "Perform moderation and bulk actions"
        ],
        "api_calls": [
          {
            "method": "GET",
            "endpoint": "/api/admin/users/search"
          },
          {
            "method": "GET",
            "endpoint": "/api/admin/businesses/search"
          },
          {
            "method": "SERVER_ACTION",
            "endpoint": "src/app/actions/admin.ts"
          }
        ],
        "auth_required": true
      }
    ],
    "known_limitations": [
      {
        "issue": "Code summary lists representative primary routes, not every nested route file.",
        "location": "src/app",
        "impact": "Some generated tests may not cover long-tail pages unless manually expanded."
      }
    ]
  }
}
